<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="en-US">
  <compounddef id="compress_8c" kind="file" language="C++">
    <compoundname>compress.c</compoundname>
    <includes refid="compress_8h" local="yes">compress.h</includes>
    <includes refid="debugmalloc_8h" local="yes">debugmalloc.h</includes>
    <includes local="no">stdio.h</includes>
    <includes local="no">string.h</includes>
    <includes refid="bitwriter_8h" local="yes">bitwriter.h</includes>
    <includes refid="_c_r_c___c_h_e_c_k_s_u_m_8h" local="yes">CRC_CHECKSUM.h</includes>
    <includes refid="distance_8h" local="yes">distance.h</includes>
    <includes refid="_h_u_f_f_m_a_n___t_a_b_l_e_8h" local="yes">HUFFMAN_TABLE.h</includes>
    <includes refid="length_8h" local="yes">length.h</includes>
    <includes refid="_l_z77_8h" local="yes">LZ77.h</includes>
    <includes refid="node_8h" local="yes">node.h</includes>
    <includes refid="status_8h" local="yes">status.h</includes>
    <incdepgraph>
      <node id="15">
        <label>CRC_CHECKSUM.h</label>
        <link refid="_c_r_c___c_h_e_c_k_s_u_m_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>HUFFMAN_TABLE.h</label>
        <link refid="_h_u_f_f_m_a_n___t_a_b_l_e_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>LZ77.h</label>
        <link refid="_l_z77_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>bitreader.h</label>
        <link refid="bitreader_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>bitwriter.h</label>
        <link refid="bitwriter_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>compress.c</label>
        <link refid="compress_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>compress.h</label>
        <link refid="compress_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>debugmalloc.h</label>
        <link refid="debugmalloc_8h"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>distance.h</label>
        <link refid="distance_8h"/>
      </node>
      <node id="20">
        <label>length.h</label>
        <link refid="length_8h"/>
      </node>
      <node id="19">
        <label>node.h</label>
        <link refid="node_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>status.h</label>
        <link refid="status_8h"/>
      </node>
      <node id="11">
        <label>ctype.h</label>
      </node>
      <node id="13">
        <label>stdarg.h</label>
      </node>
      <node id="9">
        <label>stdbool.h</label>
      </node>
      <node id="3">
        <label>stddef.h</label>
      </node>
      <node id="5">
        <label>stdint.h</label>
      </node>
      <node id="6">
        <label>stdio.h</label>
      </node>
      <node id="10">
        <label>stdlib.h</label>
      </node>
      <node id="12">
        <label>string.h</label>
      </node>
      <node id="14">
        <label>unistd.h</label>
      </node>
    </incdepgraph>
    <sectiondef kind="define">
      <memberdef kind="define" id="compress_8c_1ab0bc977d3fec2517ebda1a77e1cfaecc" prot="public" static="no">
        <name>HASH_BITS</name>
        <initializer>15</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="20" column="9" bodyfile="compress.c" bodystart="20" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a52f7ff3c0f79c8692dbd2fab70256529" prot="public" static="no">
        <name>HASH_SHIFT</name>
        <initializer>5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="21" column="9" bodyfile="compress.c" bodystart="21" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a8ba578169aad59095035a05d2f7323a7" prot="public" static="no">
        <name>HASH_MASK</name>
        <initializer>0x7FFF</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="22" column="9" bodyfile="compress.c" bodystart="22" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1ad6074dd11ab3c97c8135c43aab03ae95" prot="public" static="no">
        <name>HASH_SIZE</name>
        <initializer>(1 &lt;&lt; <ref refid="compress_8c_1ab0bc977d3fec2517ebda1a77e1cfaecc" kindref="member">HASH_BITS</ref>)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="23" column="9" bodyfile="compress.c" bodystart="23" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" prot="public" static="no">
        <name>WINDOW_SIZE</name>
        <initializer>32768</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="24" column="9" bodyfile="compress.c" bodystart="24" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a6b20d41d6252e9871430c242cb1a56e7" prot="public" static="no">
        <name>BUFFER_SIZE</name>
        <initializer>(<ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref> * 2)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="25" column="9" bodyfile="compress.c" bodystart="25" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a76660d8139575e05671801dbe5a5af50" prot="public" static="no">
        <name>EMPTY_INDEX</name>
        <initializer>0xFFFF</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="26" column="9" bodyfile="compress.c" bodystart="26" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a7c4eca8fe59888352807b89daed94258" prot="public" static="no">
        <name>LITERAL_LENGTH_SIZE</name>
        <initializer>286</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="27" column="9" bodyfile="compress.c" bodystart="27" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a351ed2b19cd87022ef91920a102312d8" prot="public" static="no">
        <name>END_OF_BLOCK</name>
        <initializer>256</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="28" column="9" bodyfile="compress.c" bodystart="28" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1ad30337fb0318fd2705318081158a6f7b" prot="public" static="no">
        <name>DISTANCE_CODE_SIZE</name>
        <initializer>30</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="29" column="9" bodyfile="compress.c" bodystart="29" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" prot="public" static="no">
        <name>CODE_LENGTH_FREQUENCIES</name>
        <initializer>19</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="30" column="9" bodyfile="compress.c" bodystart="30" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" prot="public" static="no">
        <name>BYTE</name>
        <initializer>uint8_t</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="32" column="9" bodyfile="compress.c" bodystart="32" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="var">
      <memberdef kind="variable" id="compress_8c_1a8b3ab54ed3e81c69863d65e4e6c424a0" prot="public" static="yes" mutable="no">
        <type>bool</type>
        <definition>bool flag</definition>
        <argsstring></argsstring>
        <name>flag</name>
        <initializer>= true</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="393" column="13" bodyfile="compress.c" bodystart="393" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="compress_8c_1a7aab0d55e686a3abe71d5eedf136b5c4" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void vfSubtractWindowSizeFromHashTable</definition>
        <argsstring>(uint16_t *uiarrHashTable)</argsstring>
        <name>vfSubtractWindowSizeFromHashTable</name>
        <param>
          <type>uint16_t *</type>
          <declname>uiarrHashTable</declname>
        </param>
        <briefdescription>
<para>Subtract Window Size From Hash Table. </para>
        </briefdescription>
        <detaileddescription>
<para>When a shift occurs in the buffer (when the buffer&apos;s second half gets copied to the first half) we need to subtract the WINDOW_SIZE from all valid entries in the hashTable so that the newly copied data can have a history from the previously processed data.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>uiarrHashTable</parametername>
</parameternamelist>
<parameterdescription>
<para>The hashTable which stores the last occurrence of a 3 byte hash.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>void </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="45" column="13" bodyfile="compress.c" bodystart="45" bodyend="51"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1ab8765e414b5a1c82f427a7aa82cb831c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint16_t</type>
        <definition>static uint16_t uifGenerateHashKey</definition>
        <argsstring>(const unsigned char *p)</argsstring>
        <name>uifGenerateHashKey</name>
        <param>
          <type>const unsigned char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Generate Hash Key. </para>
        </briefdescription>
        <detaileddescription>
<para>This function generates a Hash key which can be used to access values in the hashTable. The process is very simple. Shift the first byte at P by HASH_SHIFT and then xor the result with P+1 and P+2. With this simple logic we&apos;ve created a key which actually depends on 3 bytes and can index a 32kb hashTable.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>The pointer for the buffer.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>uint16_t Hash key. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="65" column="17" bodyfile="compress.c" bodystart="65" bodyend="67"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a732d47dc0ad3958155bdf3c9e1d5aba0" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned char *</type>
        <definition>static unsigned char * cpInitBuffer</definition>
        <argsstring>(void)</argsstring>
        <name>cpInitBuffer</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Init Buffer only allocates BUFFER_SIZE byte unsigned char and returns with its pointer. If the memory allocation fails then it returns with a NULL pointer. </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>unsigned char* The freshly allocated BUFFER_SIZE sized buffer. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="75" column="22" bodyfile="compress.c" bodystart="75" bodyend="81"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1aefbc1f4ca94147e2972b1705fc98f661" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int iFindMatchLength</definition>
        <argsstring>(const unsigned char *ucpCurrent, const unsigned char *ucpOld, const unsigned char *ucpInputEndPointer)</argsstring>
        <name>iFindMatchLength</name>
        <param>
          <type>const unsigned char *</type>
          <declname>ucpCurrent</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ucpOld</declname>
        </param>
        <param>
          <type>const unsigned char *</type>
          <declname>ucpInputEndPointer</declname>
        </param>
        <briefdescription>
<para>Find Match Length. </para>
        </briefdescription>
        <detaileddescription>
<para>The function takes in 3 pointers from unsigned char type and starts counts up the matching bytes at (ucpCurrent + n) and (ucpOld + n) until there is a missmatch. If we reach a total length of 258 or ucpCurrent reaches ucpInputEndPointer, we stop the search since in deflate the longest match can only be 258.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ucpCurrent</parametername>
</parameternamelist>
<parameterdescription>
<para>Current pointer </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ucpOld</parametername>
</parameternamelist>
<parameterdescription>
<para>Old pointer </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ucpInputEndPointer</parametername>
</parameternamelist>
<parameterdescription>
<para>This is the maximum Current pointer can be (the boundary of the buffer)</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>int The length of the match in bytes </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="96" column="12" bodyfile="compress.c" bodystart="96" bodyend="117"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a47738ceb24a268535fea120ecdf7c8eb" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void *</type>
        <definition>static void * fvpResetHashTable</definition>
        <argsstring>(uint16_t *uiarrHashTable)</argsstring>
        <name>fvpResetHashTable</name>
        <param>
          <type>uint16_t *</type>
          <declname>uiarrHashTable</declname>
        </param>
        <briefdescription>
<para>Reset Hash Table values. </para>
        </briefdescription>
        <detaileddescription>
<para>The fvpResetHashTable function takes an uint16_t pointer and uses the predefined variables (EMPTY_INDEX and HASH_SIZE) for setting a default value for the whole table.</para>
<para>The default value defined in EMPTY_INDEX is 0xFFFF.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>uiarrHashTable</parametername>
</parameternamelist>
<parameterdescription>
<para>The pointer to the hashTable.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>void </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="132" column="13" bodyfile="compress.c" bodystart="132" bodyend="134"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a61748e60fc7185bead3e62b5f01eeebe" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint16_t *</type>
        <definition>static uint16_t * initHashTable</definition>
        <argsstring>(void)</argsstring>
        <name>initHashTable</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>initHashTable returns with an allocated hashTable. Required space in memory is 2*HASH_SIZE. Must be freed afterward. </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>uint16_t* The pointer to the hashTable. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="143" column="17" bodyfile="compress.c" bodystart="143" bodyend="153"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1af23a493c40a7e0aff72b6ecf7f54c06b" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>FILE *</type>
        <definition>FILE * ffOpenFile</definition>
        <argsstring>(const char *filename)</argsstring>
        <name>ffOpenFile</name>
        <param>
          <type>const char *</type>
          <declname>filename</declname>
        </param>
        <briefdescription>
<para>Opens a file in rb (read binary) mode. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>filename</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the file. (probably with absolute path)</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>FILE* or NULL </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="162" column="13" bodyfile="compress.c" bodystart="162" bodyend="165" declfile="compress.c" declline="162" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a8dfb153692ba68896af5936e482d6493" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void compressData</definition>
        <argsstring>(const unsigned char *ucpBuffer, const size_t bytesRead, uint16_t *hash_table, LZ77_buffer *output_ucpBuffer)</argsstring>
        <name>compressData</name>
        <param>
          <type>const unsigned char *</type>
          <declname>ucpBuffer</declname>
        </param>
        <param>
          <type>const size_t</type>
          <declname>bytesRead</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>hash_table</declname>
        </param>
        <param>
          <type><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> *</type>
          <declname>output_ucpBuffer</declname>
        </param>
        <briefdescription>
<para>Compress Data. </para>
        </briefdescription>
        <detaileddescription>
<para>This function takes in a BUFFER SIZED buffer containing BYTES from a file, and fills up an <ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> containing match/literal distance/length codes which will be used later in the processBlock function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ucpBuffer</parametername>
</parameternamelist>
<parameterdescription>
<para>The start of the buffer (pointer). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>bytesRead</parametername>
</parameternamelist>
<parameterdescription>
<para>The bytes processed in this function. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>hash_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The hash lookup table for matches. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>output_ucpBuffer</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> containing the matches/literals.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>void </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="180" column="13" bodyfile="compress.c" bodystart="180" bodyend="237" declfile="compress.c" declline="180" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a93a371415f975d79a1778f8857d53280" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void resetUint16_tArray</definition>
        <argsstring>(uint16_t *array, const size_t size)</argsstring>
        <name>resetUint16_tArray</name>
        <param>
          <type>uint16_t *</type>
          <declname>array</declname>
        </param>
        <param>
          <type>const size_t</type>
          <declname>size</declname>
        </param>
        <briefdescription>
<para>Reset uint16_t array. </para>
        </briefdescription>
        <detaileddescription>
<para>This function takes in a pointer to an array, and its size, and sets 0 for each value.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>array</parametername>
</parameternamelist>
<parameterdescription>
<para>The pointer to the uint16_t array. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>size</parametername>
</parameternamelist>
<parameterdescription>
<para>The size of the array.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>void </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="249" column="13" bodyfile="compress.c" bodystart="249" bodyend="251"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1ae0e08df389c5998d27b2cddbe10e997b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref></type>
        <definition>static BYTE calculateHLIT</definition>
        <argsstring>(const uint16_t *LLFrequiency)</argsstring>
        <name>calculateHLIT</name>
        <param>
          <type>const uint16_t *</type>
          <declname>LLFrequiency</declname>
        </param>
        <briefdescription>
<para>Calculate HLIT. </para>
        </briefdescription>
        <detaileddescription>
<para>This function calculates the highest literal in use. Which is crucial determining how many literal/length code is in use for the whole block. It takes in an uint16_t array which holds the frequencies of the literal/length codes and returns the first index from the back which is not 0. To store this effectively on return it subtracts 257 from the index. Since the END OF BLOCK, which is 256 that will be the highest index in the worst case.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>LLFrequiency</parametername>
</parameternamelist>
<parameterdescription>
<para>The frequency table.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>BYTE </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="265" column="13" bodyfile="compress.c" bodystart="265" bodyend="274"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a1e7b3c7e9bad387ec3ea78d32e167f02" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref></type>
        <definition>static BYTE calculateHDIST</definition>
        <argsstring>(const uint16_t *distanceCodeFrequency)</argsstring>
        <name>calculateHDIST</name>
        <param>
          <type>const uint16_t *</type>
          <declname>distanceCodeFrequency</declname>
        </param>
        <briefdescription>
<para>Calculate HDIST. </para>
        </briefdescription>
        <detaileddescription>
<para>This function calculates the highest distance code in use. Since there are cases where not all distance codes are in use we save bytes from the output with not writing out unnecessary distance codes to the file. Works just like the HLIT function.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>distanceCodeFrequency</parametername>
</parameternamelist>
<parameterdescription>
<para>The distanceCode table.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>BYTE </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="286" column="13" bodyfile="compress.c" bodystart="286" bodyend="295"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a1e7a4208116628f1664b9a91c221ee2f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref></type>
        <definition>static BYTE calculateHCLEN</definition>
        <argsstring>(const uint16_t *codeLengthFrequency)</argsstring>
        <name>calculateHCLEN</name>
        <param>
          <type>const uint16_t *</type>
          <declname>codeLengthFrequency</declname>
        </param>
        <briefdescription>
<para>Calculate HCLEN. </para>
        </briefdescription>
        <detaileddescription>
<para>This function calculates the highest code length in use. This number could be from 1 to 15. Each code read from a huffman tree has a code length which is essentially a number from the top node to the leaf. In the codeLengthFrequency array we store the frequency of each code length. And here we determine which is the &apos;biggest&apos; one in use.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>codeLengthFrequency</parametername>
</parameternamelist>
<parameterdescription>
<para>The code lengths table.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>BYTE </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="310" column="13" bodyfile="compress.c" bodystart="310" bodyend="319"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a2b23d9ac6c30c3350bd1bdb4810b05a2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void countFrequencies</definition>
        <argsstring>(const LZ77_buffer *output_ucpBuffer, uint16_t *LLFrequency, uint16_t *distanceCodeFrequency)</argsstring>
        <name>countFrequencies</name>
        <param>
          <type>const <ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> *</type>
          <declname>output_ucpBuffer</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>LLFrequency</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>distanceCodeFrequency</declname>
        </param>
        <briefdescription>
<para>Count Frequencies. </para>
        </briefdescription>
        <detaileddescription>
<para>This function is accountable for counting the <ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref>&apos;s match/literals&apos; frequency. For the distance codes, it uses the distanceCodeFrequency table as an output, and for the literal/length codes the LLFrequency.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>output_ucpBuffer</parametername>
</parameternamelist>
<parameterdescription>
<para><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> table which stores the match/literals of a block. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>LLFrequency</parametername>
</parameternamelist>
<parameterdescription>
<para>The output table for literal/length codes. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>distanceCodeFrequency</parametername>
</parameternamelist>
<parameterdescription>
<para>The output table for distance codes.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>void </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="333" column="13" bodyfile="compress.c" bodystart="333" bodyend="344"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a3e415a8a2762184f30597b14823cb398" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="struct_min_heap" kindref="compound">MinHeap</ref> *</type>
        <definition>static MinHeap * createLiteralTree</definition>
        <argsstring>(const uint16_t *LLFrequency)</argsstring>
        <name>createLiteralTree</name>
        <param>
          <type>const uint16_t *</type>
          <declname>LLFrequency</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="345" column="16" bodyfile="compress.c" bodystart="345" bodyend="353"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1ad6af75f9d0fd7867c15b50009aa92c2a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="struct_min_heap" kindref="compound">MinHeap</ref> *</type>
        <definition>static MinHeap * createDistanceTree</definition>
        <argsstring>(const uint16_t *distanceCodeFrequency)</argsstring>
        <name>createDistanceTree</name>
        <param>
          <type>const uint16_t *</type>
          <declname>distanceCodeFrequency</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="355" column="16" bodyfile="compress.c" bodystart="355" bodyend="363"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a250b9388e1765088be2921b0fef65a90" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="struct_min_heap" kindref="compound">MinHeap</ref> *</type>
        <definition>static MinHeap * createCodeLengthTree</definition>
        <argsstring>(const uint16_t *codeLengthFrequencies)</argsstring>
        <name>createCodeLengthTree</name>
        <param>
          <type>const uint16_t *</type>
          <declname>codeLengthFrequencies</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="365" column="16" bodyfile="compress.c" bodystart="365" bodyend="373"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a56b0820315da001b8d577ec83574dad7" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void writeGzipTrailer</definition>
        <argsstring>(BitWriter *bw, uint32_t crc32_checksum, uint32_t total_uncompressed_size)</argsstring>
        <name>writeGzipTrailer</name>
        <param>
          <type><ref refid="struct_bit_writer" kindref="compound">BitWriter</ref> *</type>
          <declname>bw</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>crc32_checksum</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>total_uncompressed_size</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="375" column="13" bodyfile="compress.c" bodystart="375" bodyend="392" declfile="compress.c" declline="375" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1aa7597901166c3301bf52047091ed5d59" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void processBlock</definition>
        <argsstring>(BitWriter *bw, uint16_t *LLFrequency, uint16_t *distanceCodeFrequency, const LZ77_buffer *output_ucpBuffer, const bool lastBlock)</argsstring>
        <name>processBlock</name>
        <param>
          <type><ref refid="struct_bit_writer" kindref="compound">BitWriter</ref> *</type>
          <declname>bw</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>LLFrequency</declname>
        </param>
        <param>
          <type>uint16_t *</type>
          <declname>distanceCodeFrequency</declname>
        </param>
        <param>
          <type>const <ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref> *</type>
          <declname>output_ucpBuffer</declname>
        </param>
        <param>
          <type>const bool</type>
          <declname>lastBlock</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="395" column="13" bodyfile="compress.c" bodystart="395" bodyend="555" declfile="compress.c" declline="395" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="compress_8c_1a79cadd96d56d3aa879adb002a68d07d7" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="struct_status" kindref="compound">Status</ref></type>
        <definition>Status compress</definition>
        <argsstring>(char *filename)</argsstring>
        <name>compress</name>
        <param>
          <type>char *</type>
          <declname>filename</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="compress.c" line="557" column="15" bodyfile="compress.c" bodystart="557" bodyend="695" declfile="compress.c" declline="557" declcolumn="15"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Created<sp/>by<sp/>Rendszergazda<sp/>on<sp/>11/19/2025.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="compress_8h" kindref="compound">compress.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="debugmalloc_8h" kindref="compound">debugmalloc.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="bitwriter_8h" kindref="compound">bitwriter.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_c_r_c___c_h_e_c_k_s_u_m_8h" kindref="compound">CRC_CHECKSUM.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="distance_8h" kindref="compound">distance.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_h_u_f_f_m_a_n___t_a_b_l_e_8h" kindref="compound">HUFFMAN_TABLE.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="length_8h" kindref="compound">length.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_l_z77_8h" kindref="compound">LZ77.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="node_8h" kindref="compound">node.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="status_8h" kindref="compound">status.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>HASH_BITS<sp/>15</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>HASH_SHIFT<sp/>5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>HASH_MASK<sp/>0x7FFF<sp/></highlight><highlight class="comment">//<sp/>32767<sp/>for<sp/>15<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>HASH_SIZE<sp/>(1<sp/>&lt;&lt;<sp/>HASH_BITS)<sp/></highlight><highlight class="comment">//<sp/>32768</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>WINDOW_SIZE<sp/>32768</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>BUFFER_SIZE<sp/>(WINDOW_SIZE<sp/>*<sp/>2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>EMPTY_INDEX<sp/>0xFFFF</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LITERAL_LENGTH_SIZE<sp/>286</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>END_OF_BLOCK<sp/>256</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>DISTANCE_CODE_SIZE<sp/>30</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>CODE_LENGTH_FREQUENCIES<sp/>19</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>BYTE<sp/>uint8_t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>vfSubtractWindowSizeFromHashTable(uint16_t*<sp/>uiarrHashTable)<sp/>{</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i&lt;<ref refid="compress_8c_1ad6074dd11ab3c97c8135c43aab03ae95" kindref="member">HASH_SIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uiarrHashTable[i]<sp/>&gt;=<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>)<sp/>{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uiarrHashTable[i]<sp/>-=<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="51"><highlight class="normal">}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint16_t<sp/>uifGenerateHashKey(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>p)<sp/>{</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(uint16_t)<sp/>((p[0]<sp/>&lt;&lt;<sp/><ref refid="compress_8c_1a52f7ff3c0f79c8692dbd2fab70256529" kindref="member">HASH_SHIFT</ref>)<sp/>^<sp/>p[1]<sp/>^<sp/>p[2])<sp/>&amp;<sp/><ref refid="compress_8c_1a8ba578169aad59095035a05d2f7323a7" kindref="member">HASH_MASK</ref>;</highlight></codeline>
<codeline lineno="67"><highlight class="normal">}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>cpInitBuffer(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>ucpBuffer<sp/>=<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)<sp/><ref refid="debugmalloc_8h_1a535b58ab5aa48e2e86073e334d43fd32" kindref="member">malloc</ref>(<ref refid="bitreader_8c_1a6b20d41d6252e9871430c242cb1a56e7" kindref="member">BUFFER_SIZE</ref>+<ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ucpBuffer<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ucpBuffer;</highlight></codeline>
<codeline lineno="81"><highlight class="normal">}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iFindMatchLength(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>ucpCurrent,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ucpOld,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ucpInputEndPointer)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>ptrdiff_t<sp/>pdiffAvailableBytes<sp/>=<sp/>ucpInputEndPointer<sp/>-<sp/>ucpCurrent;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iMaxCheckLength<sp/>=<sp/>258;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pdiffAvailableBytes<sp/>&lt;<sp/>iMaxCheckLength)<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>iMaxCheckLength<sp/>=<sp/>(int)pdiffAvailableBytes;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>iLength<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(iLength<sp/>&lt;<sp/>iMaxCheckLength)<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ucpCurrent[iLength]<sp/>==<sp/>ucpOld[iLength])<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>iLength++;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>iLength;</highlight></codeline>
<codeline lineno="117"><highlight class="normal">}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>fvpResetHashTable(uint16_t<sp/>*uiarrHashTable)<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>memset(uiarrHashTable,<sp/><ref refid="compress_8c_1a76660d8139575e05671801dbe5a5af50" kindref="member">EMPTY_INDEX</ref>,<sp/>2<sp/>*<sp/><ref refid="compress_8c_1ad6074dd11ab3c97c8135c43aab03ae95" kindref="member">HASH_SIZE</ref>);</highlight></codeline>
<codeline lineno="134"><highlight class="normal">}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint16_t*<sp/>initHashTable(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>*uipHashTable<sp/>=<sp/><ref refid="debugmalloc_8h_1a535b58ab5aa48e2e86073e334d43fd32" kindref="member">malloc</ref>(2<sp/>*<sp/><ref refid="compress_8c_1ad6074dd11ab3c97c8135c43aab03ae95" kindref="member">HASH_SIZE</ref>);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uipHashTable<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fvpResetHashTable(uipHashTable)<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="debugmalloc_8h_1aa7943e5d135734f6801bebcc37401fc0" kindref="member">free</ref>(uipHashTable);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>uipHashTable;</highlight></codeline>
<codeline lineno="153"><highlight class="normal">}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/>FILE*<sp/><ref refid="compress_8c_1af23a493c40a7e0aff72b6ecf7f54c06b" kindref="member">ffOpenFile</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>filename)<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>FILE*<sp/>fpFile<sp/>=<sp/>fopen(filename,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fpFile;</highlight></codeline>
<codeline lineno="165"><highlight class="normal">}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1a8dfb153692ba68896af5936e482d6493" kindref="member">compressData</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ucpBuffer,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytesRead,<sp/>uint16_t*<sp/>hash_table,<sp/><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref>*<sp/>output_ucpBuffer)<sp/>{</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Set<sp/>the<sp/>End<sp/>Pointer<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ucpInputEndPointer<sp/>=<sp/>ucpBuffer<sp/>+<sp/>bytesRead;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>Loop<sp/>Control<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Loop<sp/>only<sp/>up<sp/>to<sp/>(bytesRead<sp/>-<sp/>2)<sp/>because<sp/>we<sp/>need<sp/>at<sp/>least<sp/>3<sp/>bytes<sp/>to<sp/>hash/match.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>(int)bytesRead<sp/>-<sp/>2;<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/>hashKey<sp/>=<sp/>uifGenerateHashKey(ucpBuffer<sp/>+<sp/>i);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t<sp/>hashIndex<sp/>=<sp/>hash_table[hashKey];</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bestLength<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bestDistance<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hashIndex<sp/>!=<sp/><ref refid="compress_8c_1a76660d8139575e05671801dbe5a5af50" kindref="member">EMPTY_INDEX</ref>)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>distance<sp/>=<sp/>i<sp/>-<sp/>hashIndex;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Is<sp/>distance<sp/>within<sp/>the<sp/>32KB<sp/>LZ77<sp/>window?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(distance<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>distance<sp/>&lt;=<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestLength<sp/>=<sp/>iFindMatchLength(ucpBuffer<sp/>+<sp/>i,<sp/>ucpBuffer<sp/>+<sp/>hashIndex,<sp/>ucpInputEndPointer);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestDistance<sp/>=<sp/>distance;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bestLength<sp/>&lt;<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestLength<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>Discard<sp/>match<sp/>if<sp/>too<sp/>short</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hash_table[hashKey]<sp/>=<sp/>(uint16_t)i;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bestLength<sp/>&gt;=<sp/>3)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Output<sp/>the<sp/>match<sp/>token</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_l_z77_8c_1ae7e9aa7991f2359ab5168b98783544a9" kindref="member">appendToken</ref>(output_ucpBuffer,<sp/><ref refid="_l_z77_8c_1ab1cea1d7293ff705a0980fbdb3047eef" kindref="member">createMatchLZ77</ref>(bestDistance,<sp/>bestLength));</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>+=<sp/>bestLength;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NO<sp/>MATCH<sp/>(Length<sp/>&lt;<sp/>3)<sp/>or<sp/>Invalid<sp/>distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Output<sp/>the<sp/>literal<sp/>byte<sp/>at<sp/>the<sp/>current<sp/>position<sp/>&apos;i&apos;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;Literal:<sp/>%c\n&quot;,<sp/>ucpBuffer[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_l_z77_8c_1ae7e9aa7991f2359ab5168b98783544a9" kindref="member">appendToken</ref>(output_ucpBuffer,<sp/><ref refid="_l_z77_8c_1a39a4b9657ba7447c0a42d1cc318b2a7b" kindref="member">createLiteralLZ77</ref>(ucpBuffer[i]));</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Advance<sp/>the<sp/>window<sp/>by<sp/>1<sp/>byte<sp/>(Literal<sp/>case).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i++;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>4.<sp/>HANDLE<sp/>REMAINING<sp/>BYTES<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>loop<sp/>ended<sp/>at<sp/>bytesRead<sp/>-<sp/>2.<sp/>Handle<sp/>the<sp/>last<sp/>1<sp/>or<sp/>2<sp/>bytes<sp/>as<sp/>literals.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>i<sp/>&lt;<sp/>(int)bytesRead;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;Literal:<sp/>%c\n&quot;,<sp/>ucpBuffer[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_l_z77_8c_1ae7e9aa7991f2359ab5168b98783544a9" kindref="member">appendToken</ref>(output_ucpBuffer,<sp/><ref refid="_l_z77_8c_1a39a4b9657ba7447c0a42d1cc318b2a7b" kindref="member">createLiteralLZ77</ref>(ucpBuffer[i]));</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal">}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>resetUint16_tArray(uint16_t*<sp/>array,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i&lt;size;<sp/>i++)<sp/>array[i]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="251"><highlight class="normal">}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>calculateHLIT(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>LLFrequiency)<sp/>{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>highestUsedIndex<sp/>=<sp/>256;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/><ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>-1;<sp/>i&gt;255;i--)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(LLFrequiency[i]<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>highestUsedIndex<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref>)(highestUsedIndex<sp/>-<sp/>257);</highlight></codeline>
<codeline lineno="274"><highlight class="normal">}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>calculateHDIST(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>distanceCodeFrequency)<sp/>{</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>highestUsedIndex<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/><ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>-1;<sp/>i&gt;=0;i--)<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(distanceCodeFrequency[i]<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>highestUsedIndex<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref>)<sp/>highestUsedIndex;</highlight></codeline>
<codeline lineno="295"><highlight class="normal">}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>calculateHCLEN(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>codeLengthFrequency)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>highestUsedIndex<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/><ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>-1;<sp/>i&gt;=0;i--)<sp/>{</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(codeLengthFrequency[i]<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>highestUsedIndex<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref>)<sp/>highestUsedIndex<sp/>-<sp/>4;</highlight></codeline>
<codeline lineno="319"><highlight class="normal">}</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>countFrequencies(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref>*<sp/>output_ucpBuffer,<sp/>uint16_t*<sp/>LLFrequency,<sp/>uint16_t*<sp/>distanceCodeFrequency)<sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>output_ucpBuffer-&gt;<ref refid="struct_l_z77__buffer_1a854352f53b148adc24983a58a1866d66" kindref="member">size</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_l_z77__compressed" kindref="compound">LZ77_compressed</ref><sp/>token<sp/>=<sp/>output_ucpBuffer-&gt;<ref refid="struct_l_z77__buffer_1a28dd3a7c2db4aa8526cb4b1dedb376a8" kindref="member">tokens</ref>[i];</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(token.<ref refid="struct_l_z77__compressed_1a35706548b8a67e870f95e47317246787" kindref="member">type</ref><sp/>==<sp/><ref refid="_l_z77_8h_1aa2dfc75cd7ffec5a645d9d50841b6403a01168ce90eea67d7bb43776fb0c139e5" kindref="member">LITERAL</ref>)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LLFrequency[token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a66a4fabf3d4457878d3a90d39cdd524f" kindref="member">literal</ref>]++;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>distanceCodeFrequency[<ref refid="distance_8c_1a3129c724dbfe713ed85671d9eb6c41a5" kindref="member">getDistanceCode</ref>(token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a54e81a285c801cbd44309f0d3f1658bd" kindref="member">match</ref>.<ref refid="struct_l_z77__compressed_1a7ae9d3ad463ec7a0eb38ee23a15c51e7" kindref="member">distance</ref>).<ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e_1a35a802f2592065224b239abeff51e12b" kindref="member">usSymbolID</ref>]++;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LLFrequency[<ref refid="length_8c_1ac1708113f9ba2b598b57c0290f24ddd2" kindref="member">getLengthCode</ref>(token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a54e81a285c801cbd44309f0d3f1658bd" kindref="member">match</ref>.<ref refid="struct_l_z77__compressed_1a1892eba2086d12ac2b09005aeb09ea3b" kindref="member">length</ref>).<ref refid="struct_l_e_n_g_t_h___c_o_d_e_1a35a802f2592065224b239abeff51e12b" kindref="member">usSymbolID</ref>]++;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>LLFrequency[<ref refid="compress_8c_1a351ed2b19cd87022ef91920a102312d8" kindref="member">END_OF_BLOCK</ref>]++;</highlight></codeline>
<codeline lineno="344"><highlight class="normal">}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>createLiteralTree(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>LLFrequency)<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>literalTree<sp/>=<sp/><ref refid="node_8c_1a86c7eb4d5e202d4087bde685ae659e52" kindref="member">createMinHeap</ref>(<ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(LLFrequency[i]<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="node_8c_1ac9a5be012917c9c86e4cc688eb700e0c" kindref="member">addToMinHeap</ref>(literalTree,<sp/><ref refid="node_8c_1a476e2695789ae31745b5cd5cc5877792" kindref="member">createNode</ref>(i,LLFrequency[i]));</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1ae6e53a77c8389ec5fa741eeab2e95cd9" kindref="member">buildMinHeap</ref>(literalTree);</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>literalTree;</highlight></codeline>
<codeline lineno="353"><highlight class="normal">}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>createDistanceTree(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>distanceCodeFrequency)<sp/>{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>distanceTree<sp/>=<sp/><ref refid="node_8c_1a86c7eb4d5e202d4087bde685ae659e52" kindref="member">createMinHeap</ref>(<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(distanceCodeFrequency[i]<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="node_8c_1ac9a5be012917c9c86e4cc688eb700e0c" kindref="member">addToMinHeap</ref>(distanceTree,<sp/><ref refid="node_8c_1a476e2695789ae31745b5cd5cc5877792" kindref="member">createNode</ref>(i,distanceCodeFrequency[i]));</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1ae6e53a77c8389ec5fa741eeab2e95cd9" kindref="member">buildMinHeap</ref>(distanceTree);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>distanceTree;</highlight></codeline>
<codeline lineno="363"><highlight class="normal">}</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>createCodeLengthTree(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint16_t*<sp/>codeLengthFrequencies)<sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>codeLengthTree<sp/>=<sp/><ref refid="node_8c_1a86c7eb4d5e202d4087bde685ae659e52" kindref="member">createMinHeap</ref>(<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>);</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(codeLengthFrequencies[i]<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="node_8c_1ac9a5be012917c9c86e4cc688eb700e0c" kindref="member">addToMinHeap</ref>(codeLengthTree,<sp/><ref refid="node_8c_1a476e2695789ae31745b5cd5cc5877792" kindref="member">createNode</ref>(i,codeLengthFrequencies[i]));</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1ae6e53a77c8389ec5fa741eeab2e95cd9" kindref="member">buildMinHeap</ref>(codeLengthTree);</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>codeLengthTree;</highlight></codeline>
<codeline lineno="373"><highlight class="normal">}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1a56b0820315da001b8d577ec83574dad7" kindref="member">writeGzipTrailer</ref>(<ref refid="struct_bit_writer" kindref="compound">BitWriter</ref>*<sp/>bw,<sp/>uint32_t<sp/>crc32_checksum,<sp/>uint32_t<sp/>total_uncompressed_size)<sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Finalize<sp/>CRC32:<sp/>In<sp/>standard<sp/>implementation,<sp/>the<sp/>result<sp/>needs<sp/>to<sp/>be<sp/>XORed<sp/>with<sp/>0xFFFFFFFF</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>final_crc32<sp/>=<sp/>crc32_checksum<sp/>^<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Flush<sp/>DEFLATE<sp/>bits<sp/>to<sp/>the<sp/>next<sp/>byte<sp/>boundary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>function<sp/>pads<sp/>the<sp/>last<sp/>compressed<sp/>byte<sp/>with<sp/>zeros<sp/>to<sp/>align<sp/>the<sp/>stream.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a2706da9af748aa740b5b27c3cab1921f" kindref="member">flush_bitstream_writer</ref>(bw);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Write<sp/>CRC32<sp/>(4<sp/>bytes,<sp/>LSB<sp/>first)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>write_uint32_lsb<sp/>function<sp/>ensures<sp/>the<sp/>correct<sp/>Little-Endian<sp/>byte<sp/>order.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1ae0a3c065d2db177bf4312adaab2a96a8" kindref="member">addBytesFromMSB</ref>(bw,<sp/>final_crc32,4);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>4.<sp/>Write<sp/>ISIZE<sp/>(4<sp/>bytes,<sp/>LSB<sp/>first)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1ae0a3c065d2db177bf4312adaab2a96a8" kindref="member">addBytesFromMSB</ref>(bw,<sp/>total_uncompressed_size,4);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>stream<sp/>is<sp/>now<sp/>complete,<sp/>ready<sp/>for<sp/>closeBitWriter()<sp/>which<sp/>handles<sp/>the<sp/>final<sp/>buffer<sp/>flush<sp/>to<sp/>disk.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal">}</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>flag<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aa7597901166c3301bf52047091ed5d59" kindref="member">processBlock</ref>(<ref refid="struct_bit_writer" kindref="compound">BitWriter</ref>*<sp/>bw,<sp/>uint16_t*<sp/>LLFrequency,<sp/>uint16_t*<sp/>distanceCodeFrequency,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref>*<sp/>output_ucpBuffer,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>lastBlock)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>resetUint16_tArray(LLFrequency,<ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>resetUint16_tArray(distanceCodeFrequency,<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i&lt;<sp/><ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>;i++)<sp/>{</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;LLFrequency<sp/>at<sp/>index<sp/>%d<sp/>is<sp/>%d\n&quot;,<sp/>i,<sp/>LLFrequency[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>countFrequencies(output_ucpBuffer,LLFrequency,distanceCodeFrequency);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="403"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Create<sp/>2<sp/>MinHeaps<sp/>to<sp/>make<sp/>the<sp/>huffman<sp/>tree<sp/>build<sp/>possible</highlight></codeline>
<codeline lineno="404"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>literalTree<sp/>=<sp/>createLiteralTree(LLFrequency);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>distanceTree<sp/>=<sp/>createDistanceTree(distanceCodeFrequency);</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_node" kindref="compound">Node</ref>*<sp/>literalTop<sp/>=<sp/><ref refid="node_8c_1a7dddf9d8d87a548cf9d63568af9f56fa" kindref="member">buildHuffmanTree</ref>(literalTree);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_node" kindref="compound">Node</ref>*<sp/>distanceTop<sp/>=<sp/><ref refid="node_8c_1a7dddf9d8d87a548cf9d63568af9f56fa" kindref="member">buildHuffmanTree</ref>(distanceTree);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>highestLiteralInUse<sp/>=<sp/>calculateHLIT(LLFrequency);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>highestDistanceCodeInUse<sp/>=<sp/>calculateHDIST(distanceCodeFrequency);</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Find<sp/>how<sp/>deap<sp/>a<sp/>leaf<sp/>is<sp/>in<sp/>a<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//for<sp/>this<sp/>we<sp/>use<sp/>an<sp/>BYTE<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>ll_lengths[<ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>distance_lengths[<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>total_lengths<sp/>=<sp/>(highestLiteralInUse<sp/>+<sp/>257)<sp/>+<sp/>(highestDistanceCodeInUse<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>combinedLL_Distance_lengths[total_lengths];</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//now<sp/>we<sp/>go<sp/>through<sp/>the<sp/>tree<sp/>using<sp/>the<sp/>function<sp/>in<sp/>node.h</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//and<sp/>find<sp/>the<sp/>deepness<sp/>of<sp/>each<sp/>leaf</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1a25107a4508c2ffd75825c42e1239fa90" kindref="member">findCodeLengthsInTree</ref>(literalTop,ll_lengths,0);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1a25107a4508c2ffd75825c42e1239fa90" kindref="member">findCodeLengthsInTree</ref>(distanceTop,distance_lengths,0);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//combine<sp/>the<sp/>two<sp/>results<sp/>into<sp/>one<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(combinedLL_Distance_lengths,ll_lengths,highestLiteralInUse+257);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(combinedLL_Distance_lengths+highestLiteralInUse+257,distance_lengths,highestDistanceCodeInUse+1);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//now<sp/>call<sp/>the<sp/>compress<sp/>code<sp/>lenghts<sp/>function<sp/>on<sp/>this<sp/>combined<sp/>distance<sp/>and<sp/>literal/lenghts<sp/>pair</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>compressed_ll_dist_lengths[total_lengths+20];</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>extra_bits_values[total_lengths+20];</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>code_length_frequencies[<ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>compressed_symbol_count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1aa1c5f84fe9f09a17b82d2ed396c1e1ad" kindref="member">compressCodeLengths</ref>(combinedLL_Distance_lengths,total_lengths,compressed_ll_dist_lengths,code_length_frequencies,extra_bits_values,&amp;compressed_symbol_count);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_min_heap" kindref="compound">MinHeap</ref>*<sp/>codeLengthMinHeap<sp/>=<sp/>createCodeLengthTree(code_length_frequencies);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_node" kindref="compound">Node</ref>*<sp/>clTop<sp/>=<sp/><ref refid="node_8c_1a7dddf9d8d87a548cf9d63568af9f56fa" kindref="member">buildHuffmanTree</ref>(codeLengthMinHeap);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>highestCodeLengthInUse<sp/>=<sp/>calculateHCLEN(code_length_frequencies);</highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;Length<sp/>for<sp/>symbol<sp/>%c,<sp/>is<sp/>%d<sp/>\n&quot;,(char)i,ll_lengths[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;Code<sp/>Length<sp/>frequency<sp/>for<sp/>index<sp/>%d<sp/>%d<sp/>\n&quot;,i,code_length_frequencies[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Write<sp/>to<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lastBlock)<sp/>{</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>0b01,1);</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,0b0,1);<sp/></highlight><highlight class="comment">//not<sp/>the<sp/>last<sp/>block</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,0b10,2);<sp/></highlight><highlight class="comment">//dynamic<sp/>huffman</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//HLIT<sp/>5bit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>highestLiteralInUse,5);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;highest<sp/>literal<sp/>in<sp/>use:<sp/>%d\n&quot;,highestLiteralInUse);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//HDIST<sp/>5bit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>highestDistanceCodeInUse,5);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;highest<sp/>distance<sp/>code<sp/>in<sp/>use:<sp/>%d\n&quot;,highestDistanceCodeInUse);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//HCLEN<sp/>4bit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>highestCodeLengthInUse,4);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;highest<sp/>code<sp/>length<sp/>in<sp/>use:<sp/>%d\n&quot;,highestCodeLengthInUse);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>cl_lengths[<ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1a25107a4508c2ffd75825c42e1239fa90" kindref="member">findCodeLengthsInTree</ref>(clTop,<sp/>cl_lengths,<sp/>0);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Write<sp/>the<sp/>Code<sp/>Lengths<sp/>of<sp/>the<sp/>Code<sp/>Lengths<sp/>(Meta-Tree<sp/>Definition)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>cl_order[19]<sp/>=<sp/>{<sp/>16,<sp/>17,<sp/>18,<sp/>0,<sp/>8,<sp/>7,<sp/>9,<sp/>6,<sp/>10,<sp/>5,<sp/>11,<sp/>4,<sp/>12,<sp/>3,<sp/>13,<sp/>2,<sp/>14,<sp/>1,<sp/>15<sp/>};</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>hclen_value<sp/>=<sp/>highestCodeLengthInUse<sp/>+<sp/>4;<sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>the<sp/>total<sp/>count<sp/>of<sp/>symbols<sp/>(4-19)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>hclen_value;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Each<sp/>length<sp/>is<sp/>3<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>symbol<sp/>=<sp/>cl_order[i];</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>cl_lengths[symbol],<sp/>3);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(flag)<sp/>{printf(</highlight><highlight class="stringliteral">&quot;%d<sp/>%d\n&quot;</highlight><highlight class="normal">,symbol,cl_lengths[symbol]);}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/>flag<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>printf(</highlight><highlight class="stringliteral">&quot;\n\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>ll_table[<ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>distance_table[<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>cl_table[<ref refid="compress_8c_1a5f9bb71c82ea3fa727a1dff9447dff20" kindref="member">CODE_LENGTH_FREQUENCIES</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_h_u_f_f_m_a_n___t_a_b_l_e_8c_1a32e731d206254fe2aa33026e72d81cf0" kindref="member">buildCodeLookupTable</ref>(literalTop,<sp/>ll_table,0,0);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_h_u_f_f_m_a_n___t_a_b_l_e_8c_1a32e731d206254fe2aa33026e72d81cf0" kindref="member">buildCodeLookupTable</ref>(distanceTop,<sp/>distance_table,0,0);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_h_u_f_f_m_a_n___t_a_b_l_e_8c_1a32e731d206254fe2aa33026e72d81cf0" kindref="member">buildCodeLookupTable</ref>(clTop,<sp/>cl_table,0,0);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;compressed_symbol_count:<sp/>%llu,<sp/>-<sp/>-<sp/>%llu\n&quot;,compressed_symbol_count,<sp/>total_lengths);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>compressed_symbol_count;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aec93e83855ac17c3c25c55c37ca186dd" kindref="member">BYTE</ref><sp/>symbol<sp/>=<sp/>compressed_ll_dist_lengths[i];</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>hCode<sp/>=<sp/>cl_table[symbol];</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Write<sp/>the<sp/>Huffman<sp/>Code<sp/>for<sp/>the<sp/>RLE<sp/>symbol</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>hCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1a70008c0b7822b172472813e6730ea565" kindref="member">code</ref>,<sp/>hCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1ab2b3adeb2a67e656ff030b56727fd0ac" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Write<sp/>the<sp/>Extra<sp/>Bits<sp/>if<sp/>the<sp/>symbol<sp/>requires<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(symbol<sp/>==<sp/>16)<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Repeat<sp/>previous<sp/>length<sp/>3-6<sp/>times<sp/>(2<sp/>extra<sp/>bits)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>extra_bits_values[i],<sp/>2);</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(symbol<sp/>==<sp/>17)<sp/>{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Repeat<sp/>0<sp/>length<sp/>3-10<sp/>times<sp/>(3<sp/>extra<sp/>bits)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>extra_bits_values[i],<sp/>3);</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(symbol<sp/>==<sp/>18)<sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Repeat<sp/>0<sp/>length<sp/>11-138<sp/>times<sp/>(7<sp/>extra<sp/>bits)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>extra_bits_values[i],<sp/>7);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>@todo<sp/>make<sp/>the<sp/>LENGTH_CODE<sp/>table<sp/>first<sp/>and<sp/>then<sp/>the<sp/>lookup<sp/>should<sp/>be<sp/>much<sp/>easier<sp/>and<sp/>faster</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>output_ucpBuffer-&gt;<ref refid="struct_l_z77__buffer_1a854352f53b148adc24983a58a1866d66" kindref="member">size</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_l_z77__compressed" kindref="compound">LZ77_compressed</ref><sp/>token<sp/>=<sp/>output_ucpBuffer-&gt;<ref refid="struct_l_z77__buffer_1a28dd3a7c2db4aa8526cb4b1dedb376a8" kindref="member">tokens</ref>[i];</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(token.<ref refid="struct_l_z77__compressed_1a35706548b8a67e870f95e47317246787" kindref="member">type</ref><sp/>==<sp/><ref refid="_l_z77_8h_1aa2dfc75cd7ffec5a645d9d50841b6403a01168ce90eea67d7bb43776fb0c139e5" kindref="member">LITERAL</ref>)<sp/>{</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>hc<sp/>=<sp/>ll_table[token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a66a4fabf3d4457878d3a90d39cdd524f" kindref="member">literal</ref>];</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,hc.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1a70008c0b7822b172472813e6730ea565" kindref="member">code</ref>,hc.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1ab2b3adeb2a67e656ff030b56727fd0ac" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_l_e_n_g_t_h___c_o_d_e" kindref="compound">LENGTH_CODE</ref><sp/>lc<sp/>=<sp/><ref refid="length_8c_1ac1708113f9ba2b598b57c0290f24ddd2" kindref="member">getLengthCode</ref>(token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a54e81a285c801cbd44309f0d3f1658bd" kindref="member">match</ref>.<ref refid="struct_l_z77__compressed_1a1892eba2086d12ac2b09005aeb09ea3b" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>symbol<sp/>ID<sp/>for<sp/>lookup,<sp/>NOT<sp/>the<sp/>raw<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>lengthCode<sp/>=<sp/>ll_table[lc.<ref refid="struct_l_e_n_g_t_h___c_o_d_e_1a35a802f2592065224b239abeff51e12b" kindref="member">usSymbolID</ref>];</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>the<sp/>code<sp/>and<sp/>extra<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,lengthCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1a70008c0b7822b172472813e6730ea565" kindref="member">code</ref>,lengthCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1ab2b3adeb2a67e656ff030b56727fd0ac" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lc.<ref refid="struct_l_e_n_g_t_h___c_o_d_e_1ad0421cae1a69a1e660a2ee6e36927944" kindref="member">iExtraBits</ref>&gt;0)<sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>lc.<ref refid="struct_l_e_n_g_t_h___c_o_d_e_1ab7a5eb6abde049fad9d90625143477ee" kindref="member">iExtraValue</ref>,<sp/>lc.<ref refid="struct_l_e_n_g_t_h___c_o_d_e_1ad0421cae1a69a1e660a2ee6e36927944" kindref="member">iExtraBits</ref>);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Look<sp/>up<sp/>the<sp/>distance<sp/>code<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e" kindref="compound">DISTANCE_CODE</ref><sp/>dc<sp/>=<sp/><ref refid="distance_8c_1a3129c724dbfe713ed85671d9eb6c41a5" kindref="member">getDistanceCode</ref>(token.<ref refid="struct_l_z77__compressed_1a7871b753ccbbfe74395eb47be0a9f46e" kindref="member">data</ref>.<ref refid="struct_l_z77__compressed_1a54e81a285c801cbd44309f0d3f1658bd" kindref="member">match</ref>.<ref refid="struct_l_z77__compressed_1a7ae9d3ad463ec7a0eb38ee23a15c51e7" kindref="member">distance</ref>);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>symbol<sp/>ID<sp/>for<sp/>lookup,<sp/>NOT<sp/>the<sp/>raw<sp/>distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>distanceCode<sp/>=<sp/>distance_table[dc.<ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e_1a35a802f2592065224b239abeff51e12b" kindref="member">usSymbolID</ref>];</highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Write<sp/>the<sp/>code<sp/>and<sp/>extra<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,distanceCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1a70008c0b7822b172472813e6730ea565" kindref="member">code</ref>,<sp/>distanceCode.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1ab2b3adeb2a67e656ff030b56727fd0ac" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dc.<ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e_1ad0421cae1a69a1e660a2ee6e36927944" kindref="member">iExtraBits</ref>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,dc.<ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e_1ab7a5eb6abde049fad9d90625143477ee" kindref="member">iExtraValue</ref>,<sp/>dc.<ref refid="struct_d_i_s_t_a_n_c_e___c_o_d_e_1ad0421cae1a69a1e660a2ee6e36927944" kindref="member">iExtraBits</ref>);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="struct_h_u_f_f_m_a_n___c_o_d_e" kindref="compound">HUFFMAN_CODE</ref><sp/>EOB<sp/>=<sp/>ll_table[<ref refid="compress_8c_1a351ed2b19cd87022ef91920a102312d8" kindref="member">END_OF_BLOCK</ref>];</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a15a48f26be9076026f0174a67935fce4" kindref="member">addData</ref>(bw,<sp/>EOB.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1a70008c0b7822b172472813e6730ea565" kindref="member">code</ref>,<sp/>EOB.<ref refid="struct_h_u_f_f_m_a_n___c_o_d_e_1ab2b3adeb2a67e656ff030b56727fd0ac" kindref="member">length</ref>);</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Free<sp/>up<sp/>memory<sp/>pointers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afdf92c04775f1fdb56a48a6063f30b51" kindref="member">freeTree</ref>(clTop);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afdf92c04775f1fdb56a48a6063f30b51" kindref="member">freeTree</ref>(distanceTop);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afdf92c04775f1fdb56a48a6063f30b51" kindref="member">freeTree</ref>(literalTop);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afbdba32d1543027eda02773bce2ab102" kindref="member">freeMinHeap</ref>(literalTree);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afbdba32d1543027eda02773bce2ab102" kindref="member">freeMinHeap</ref>(distanceTree);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="node_8c_1afbdba32d1543027eda02773bce2ab102" kindref="member">freeMinHeap</ref>(codeLengthMinHeap);</highlight></codeline>
<codeline lineno="555"><highlight class="normal">}</highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/><ref refid="struct_status" kindref="compound">Status</ref><sp/><ref refid="compress_8c_1a79cadd96d56d3aa879adb002a68d07d7" kindref="member">compress</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>filename)<sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_status" kindref="compound">Status</ref><sp/>status<sp/>=<sp/>{.code<sp/>=<sp/><ref refid="status_8h_1ae98a46f4ea1a43ca48acaf15d2eb7113a09cef15ce74dd210178fb13f499f9d45" kindref="member">COMPRESSION_SUCCESS</ref>,.message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;File<sp/>compression<sp/>succeeded!&quot;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/>FILE*<sp/>file<sp/>=<sp/><ref refid="compress_8c_1af23a493c40a7e0aff72b6ecf7f54c06b" kindref="member">ffOpenFile</ref>(filename);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(file==NULL)<sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0ecce7ac25584e143ec56590e89efacd" kindref="member">code</ref><sp/>=<sp/><ref refid="status_8h_1ae98a46f4ea1a43ca48acaf15d2eb7113a7f2c49fa939c7752b915cc5e036d71f5" kindref="member">CANT_OPEN_FILE</ref>;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0b2e8c7f76df48129f994ecc46d5c66c" kindref="member">message</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Can\&apos;t<sp/>open<sp/>input<sp/>file!&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t*<sp/>hashTable<sp/>=<sp/>initHashTable();</highlight></codeline>
<codeline lineno="568"><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hashTable<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0ecce7ac25584e143ec56590e89efacd" kindref="member">code</ref><sp/>=<sp/><ref refid="status_8h_1ae98a46f4ea1a43ca48acaf15d2eb7113aa0af6be8799bdc759439eaf5233f09ab" kindref="member">CANT_ALLOCATE_MEMORY</ref>;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0b2e8c7f76df48129f994ecc46d5c66c" kindref="member">message</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Can\&apos;t<sp/>allocate<sp/>memory<sp/>for<sp/>a<sp/>hash<sp/>table!&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>ucpBuffer<sp/>=<sp/>cpInitBuffer();</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ucpBuffer<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0ecce7ac25584e143ec56590e89efacd" kindref="member">code</ref><sp/>=<sp/><ref refid="status_8h_1ae98a46f4ea1a43ca48acaf15d2eb7113aa0af6be8799bdc759439eaf5233f09ab" kindref="member">CANT_ALLOCATE_MEMORY</ref>;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status.<ref refid="struct_status_1a0b2e8c7f76df48129f994ecc46d5c66c" kindref="member">message</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Can\&apos;t<sp/>allocate<sp/>memory<sp/>for<sp/>a<sp/>ucpBuffer!&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="debugmalloc_8h_1aa7943e5d135734f6801bebcc37401fc0" kindref="member">free</ref>(hashTable);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>1.<sp/>Initialization<sp/>and<sp/>Setup<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>LZ77/Huffman<sp/>structures</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_l_z77__buffer" kindref="compound">LZ77_buffer</ref>*<sp/>outputBuffer<sp/>=<sp/><ref refid="_l_z77_8c_1a17ad95ccbd3d7d4a7ac4ffbee2c989ed" kindref="member">initLZ77Buffer</ref>();</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Huffman<sp/>Frequency<sp/>arrays</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>LLFrequency[<ref refid="compress_8c_1a7c4eca8fe59888352807b89daed94258" kindref="member">LITERAL_LENGTH_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/>uint16_t<sp/>distanceCodeFrequency[<ref refid="compress_8c_1ad30337fb0318fd2705318081158a6f7b" kindref="member">DISTANCE_CODE_SIZE</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Bitstream<sp/>writer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="struct_bit_writer" kindref="compound">BitWriter</ref>*<sp/>bitWriter<sp/>=<sp/><ref refid="bitwriter_8c_1a98decd406fc97f3a5e87a1c5e43450f6" kindref="member">initBitWriter</ref>();</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a3725b55a47460bd10421c92495b2be3f" kindref="member">createFile</ref>(bitWriter,<sp/>filename,<sp/></highlight><highlight class="stringliteral">&quot;gz&quot;</highlight><highlight class="normal">);<sp/></highlight><highlight class="comment">//<sp/>Use<sp/>&quot;gz&quot;<sp/>extension</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>crc32_checksum<sp/>=<sp/>0xFFFFFFFF;<sp/></highlight><highlight class="comment">//<sp/>CRC32<sp/>is<sp/>initialized<sp/>to<sp/>all<sp/>ones</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>total_uncompressed_size<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Counters<sp/>and<sp/>state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>chunk_bytesRead<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>current_buffer_pos<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>Tracks<sp/>the<sp/>start<sp/>of<sp/>the<sp/>current<sp/>compression<sp/>window</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_final_block<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>2.<sp/>Main<sp/>Compression<sp/>Loop<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>the<sp/>first<sp/>complete<sp/>window<sp/>or<sp/>the<sp/>entire<sp/>file<sp/>if<sp/>small.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Read<sp/>directly<sp/>into<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>buffer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>chunk_bytesRead<sp/>=<sp/>fread(ucpBuffer,<sp/>1,<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>,<sp/>file);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Loop<sp/>continues<sp/>as<sp/>long<sp/>as<sp/>we<sp/>read<sp/>any<sp/>data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Prepare<sp/>the<sp/>next<sp/>LZ77<sp/>compression<sp/>step</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes_to_compress<sp/>=<sp/>chunk_bytesRead;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bytes_to_compress<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>CRC32<sp/>with<sp/>the<sp/>data<sp/>we<sp/>just<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CRC32<sp/>calculation<sp/>must<sp/>be<sp/>done<sp/>over<sp/>the<sp/>UNCOMPRESSED<sp/>data<sp/>(ucpBuffer)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crc32_checksum<sp/>=<sp/><ref refid="_c_r_c___c_h_e_c_k_s_u_m_8c_1a949564d32e176c6849b5ccc68c4947f3" kindref="member">calculate_crc32</ref>(</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crc32_checksum,</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ucpBuffer<sp/>+<sp/>current_buffer_pos,</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bytes_to_compress</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>total<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>total_uncompressed_size<sp/>+=<sp/>(uint32_t)bytes_to_compress;</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>A.<sp/>Perform<sp/>Compression<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compressData<sp/>uses<sp/>the<sp/>history<sp/>(window)<sp/>up<sp/>to<sp/>current_buffer_pos</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compress_8c_1a8dfb153692ba68896af5936e482d6493" kindref="member">compressData</ref>(</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ucpBuffer<sp/>+<sp/>current_buffer_pos,</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bytes_to_compress,</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hashTable,</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputBuffer</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>B.<sp/>Determine<sp/>Final<sp/>Block<sp/>Status<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>last<sp/>read<sp/>was<sp/>less<sp/>than<sp/>WINDOW_SIZE,<sp/>this<sp/>is<sp/>the<sp/>last<sp/>chunk<sp/>of<sp/>data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>last<sp/>read<sp/>was<sp/>0,<sp/>it<sp/>means<sp/>the<sp/>previous<sp/>block<sp/>was<sp/>the<sp/>last<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is_final_block<sp/>=<sp/>(chunk_bytesRead<sp/>&lt;<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>)<sp/>||<sp/>feof(file);</highlight></codeline>
<codeline lineno="641"><highlight class="normal"></highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>C.<sp/>Process<sp/>and<sp/>Write<sp/>Block<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>where<sp/>the<sp/>Huffman<sp/>trees<sp/>are<sp/>built<sp/>and<sp/>the<sp/>block<sp/>is<sp/>written.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="compress_8c_1aa7597901166c3301bf52047091ed5d59" kindref="member">processBlock</ref>(</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bitWriter,</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LLFrequency,</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>distanceCodeFrequency,</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputBuffer,</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is_final_block</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>---<sp/>D.<sp/>Prepare<sp/>for<sp/>Next<sp/>Iteration<sp/>---</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Reset<sp/>Buffer<sp/>for<sp/>next<sp/>chunk<sp/>(LZ77<sp/>compression<sp/>resets<sp/>the<sp/>output<sp/>buffer)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="_l_z77_8c_1aae1527487667bef65a7944ecb3ba6bac" kindref="member">freeLZ77Buffer</ref>(outputBuffer);</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputBuffer<sp/>=<sp/><ref refid="_l_z77_8c_1a17ad95ccbd3d7d4a7ac4ffbee2c989ed" kindref="member">initLZ77Buffer</ref>();</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Shift<sp/>the<sp/>window:<sp/>The<sp/>new<sp/>window<sp/>starts<sp/>where<sp/>the<sp/>compressed<sp/>data<sp/>ended.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>only<sp/>need<sp/>to<sp/>keep<sp/>the<sp/>history<sp/>(the<sp/>previous<sp/>WINDOW_SIZE)<sp/>in<sp/>ucpBuffer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>this<sp/>setup,<sp/>we<sp/>compress<sp/>the<sp/>entire<sp/>current<sp/>window<sp/>and<sp/>then<sp/>slide<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Shift<sp/>the<sp/>data<sp/>buffer<sp/>for<sp/>the<sp/>next<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_final_block)<sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Keep<sp/>the<sp/>last<sp/>WINDOW_SIZE<sp/>of<sp/>data<sp/>for<sp/>history</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(ucpBuffer,<sp/>ucpBuffer<sp/>+<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>,<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>);</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vfSubtractWindowSizeFromHashTable(hashTable);</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Read<sp/>the<sp/>next<sp/>WINDOW_SIZE<sp/>chunk<sp/>into<sp/>the<sp/>second<sp/>half<sp/>of<sp/>the<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chunk_bytesRead<sp/>=<sp/>fread(ucpBuffer<sp/>+<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>,<sp/>1,<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>,<sp/>file);</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>effective<sp/>data<sp/>to<sp/>compress<sp/>is<sp/>now<sp/>at<sp/>ucpBuffer<sp/>+<sp/>WINDOW_SIZE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_buffer_pos<sp/>=<sp/><ref refid="compress_8c_1ab3f68d59e815ea166f8c983bc6e85c5b" kindref="member">WINDOW_SIZE</ref>;</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it&apos;s<sp/>the<sp/>final<sp/>block,<sp/>stop<sp/>the<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chunk_bytesRead<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(chunk_bytesRead<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="681"><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/>crc32_checksum<sp/>=<sp/>crc32_checksum<sp/>^<sp/>0xFFFFFFFF;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1ae0a3c065d2db177bf4312adaab2a96a8" kindref="member">addBytesFromMSB</ref>(bitWriter,crc32_checksum,4);</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1ae0a3c065d2db177bf4312adaab2a96a8" kindref="member">addBytesFromMSB</ref>(bitWriter,total_uncompressed_size,4);</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>5.<sp/>Close<sp/>the<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/>fclose(file);</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="debugmalloc_8h_1aa7943e5d135734f6801bebcc37401fc0" kindref="member">free</ref>(hashTable);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="debugmalloc_8h_1aa7943e5d135734f6801bebcc37401fc0" kindref="member">free</ref>(ucpBuffer);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_l_z77_8c_1aae1527487667bef65a7944ecb3ba6bac" kindref="member">freeLZ77Buffer</ref>(outputBuffer);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="bitwriter_8c_1a0bc036019ea04608e40ea43ac2a4efe1" kindref="member">freeBitWriter</ref>(bitWriter);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="695"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="compress.c"/>
  </compounddef>
</doxygen>
